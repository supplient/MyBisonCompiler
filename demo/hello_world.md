本文档将说明rtex最基本的要素。

# rtex程序的构成
你可以在任何markdown文件中插入rtex段落。插入方法分为块段落(Block Paragraph)和行段落(Inline Paragraph)。块段落以\@@@为标记符，行段落以\@@为标记符。

例如：

```
    \@@@
    let Real k;
    k = 3;
    \@@@
```

将会插入一个rtex块段落。经过rtex编译器后，它会被转换成[mdmath](https://marketplace.visualstudio.com/items?itemName=goessner.mdmath)，再经过mdmath转换，就会生成html文件。上述段落最终的转换效果如下：

@@@
let Real k;
k = 3;
@@@

行段落也是同理。$k=$`\@@ k; \@@`会被转换成$k=$ @@ k; @@。

每个rtex段落又是语句(statement)的序列，每个语句都以分号结尾。每个语句又是语段(phase)的序列，语段之间用#拼接，例如：

```rtex
    \@@@
    let Matrix M_{2,2};
    M_{i,j} = i+j #where i=0,1...1 #where j=0,1...1;
    \@@@
```

其中第二行就是由三个语段构成的语句。转换结果是：

@@@
let Matrix M_{2,2};
M_{i,j} = i+j #where i=0,1...1 #where j=0,1...1;
@@@

最终会得到$M=$@@ M; @@。

而语段中可以包含若干表达式(expression)，其数量和位置根据语段类型的不同而不同。上文中`k=3`的左端的`k`和右端的`3`分别为左值表达式和右值表达式。

## 打印语句(Print Statement)
除了上述的程序结构外，出于方便的考虑，还有一个特例，那就是打印语句。语句除了由语段构成，还可以由一个右值表达式直接表示。其效果就是打印出该右值表达式的值。例如`\@@ k; \@@`会将变量k的值打印出来：@@k;@@。


# 语段(Phase)
目前rtex有三类语段：类型语段(Type Phase)，赋值语段(Assign Phase)，where语段(Where Phase)。

类型语段会在rtex上下文的符号表中插入标识符，并将其标记为指定的类型。例如`\@@ let Matrix K_{3, 3}; \@@`，转化为@@ let Matrix K_{3, 3}; @@会声明一个3行3列的矩阵变量。

赋值语段顾名思义，会将等号右边的表达式的值赋给等号左边的变量。例如`\@@ K_{0,1}=2; \@@`，转化为@@ K_{0,1}=2; @@会将2赋给$K$的第0行第1列。打印检查一下：@@K;@@。

where语段实质上就是循环控制，它会迭代执行它左侧的所有语段，循环变量使用省略号表达式来指定。例如`\@@ K_{i,0}=1 #where i=0,1...2; \@@`，转化为@@ K_{i,0}=1 #where i=0,1...2; @@会将矩阵$K$的第0列全部赋为1。打印检查一下：@@K;@@。


## if表达式(If Expression)
if表达式是特殊的表达式，它虽然不是语段，但是因为它给人的感觉是应该要是语段才对，所以放在这里介绍。例如：

```
    \@@@
    k = (
        2, if K_{0,1}>2 #
        1, else
    );
    \@@@
```

会被转换为：

@@@
k = (
    2, if K_{0,1}>2 #
    1, else
);
@@@

其结果因为$K_{0,1}$之前被我们赋为了2，所以$k=$ @@ k; @@。

# 矩阵运算
直接以字面值的形式给矩阵赋值：

```rtex
    \@@@
    let Matrix B_{2,2};
    B = [(2,2)
        0, 1,
        2, 3
    ];
    \@@@
```

转换为：

@@@
let Matrix B_{2,2};
B = [(2,2)
    0, 1,
    2, 3
];
@@@

结果为$B=$ @@B;@@

矩阵乘法目前打印出来不太好看，但也实现了：

```rtex
    \@@@
    let Matrix C_{2,2};
    C = [(2,2)
        3, 2,
        1, 0
    ];
    C = C * B;
    \@@@
```

转换为：

@@@
let Matrix C_{2,2};
C = [(2,2)
    3, 2,
    1, 0
];
C = C * B;
@@@

其结果$C=$@@C;@@。

还有矩阵转置：

```rtex
    \@@@
    C=C^T;
    \@@@
```

转换为：

@@@
C=C^T;
@@@

得到$C=$@@C;@@。